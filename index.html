<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSO Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --accent: #007bff; 
            --bg: #000; 
            --card: rgba(255, 255, 255, 0.95); 
            --text: #333; 
            --tab-bg: #eee; 
            --canvas-bg: #e9ecef;
        }
        
        [data-theme="dark"] {
            --card: rgba(30, 30, 30, 0.95);
            --text: #f1f1f1;
            --tab-bg: #333;
            --canvas-bg: #2a2a2a;
        }

        @keyframes rainbow {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; transition: 0.3s; }
        body { background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; color: var(--text); }

        .container { 
            background: var(--card); width: 100%; max-width: 600px; 
            border-radius: 30px; padding: 25px; box-shadow: 0 0 30px rgba(255,255,255,0.1); 
            text-align: center; border: 4px solid transparent;
            background-image: linear-gradient(var(--card), var(--card)), 
                              linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff);
            background-origin: border-box; background-clip: padding-box, border-box;
            background-size: 200% auto; animation: rainbow 4s linear infinite;
        }

        /* 3D Rainbow Text for Labels & Titles */
        .brand-name h2, .label, .tab-text, .btn-text, #theme-text { 
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff);
            background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: rainbow 3s linear infinite; font-weight: 900 !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); text-transform: uppercase;
        }

        /* Plain Icons */
        i { color: var(--text) !important; -webkit-text-fill-color: initial !important; background: none !important; animation: none !important; }

        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .right-section { display: flex; align-items: center; gap: 12px; }
        .fb-logo { color: #1877F2 !important; font-size: 26px; text-decoration: none; }
        
        .dark-mode-btn { background: var(--tab-bg); border: 1px solid rgba(150,150,150,0.2); padding: 8px 15px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        .tabs { display: flex; background: var(--tab-bg); border-radius: 15px; padding: 5px; margin-bottom: 25px; }
        .tab { flex: 1; padding: 12px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab.active { background: var(--card); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* Grid for Select Boxes */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: left; margin-bottom: 20px; }
        .label { font-size: 11px; margin-bottom: 8px; display: block; }
        .select-box { width: 100%; padding: 12px; border: 1px solid #55555540; border-radius: 12px; background: var(--card); color: var(--text); outline: none; cursor: pointer; }

        /* Preview Area */
        #capture-area { 
            width: 100%; height: 480px; background: var(--canvas-bg); border-radius: 20px;
            display: flex; justify-content: center; align-items: center; 
            position: relative; overflow: hidden; cursor: pointer; border: 1px solid #55555520;
        }
        .phone-frame { width: 220px; height: 450px; background: #000; border: 10px solid #333; border-radius: 40px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        
        #preview-img, #preview-video { width: 100%; height: 100%; object-fit: cover; display: none; }
        #plus-icon { font-size: 50px; color: #fff; opacity: 0.2; position: absolute; }

        .btn { width: 100%; padding: 16px; border-radius: 50px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        .btn-upload { background: transparent; border: 2px dashed var(--accent); }
        .btn-save { background: var(--accent); color: white; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <div class="brand-name"><h2>KSO</h2></div>
        <div class="right-section">
            <a href="https://www.facebook.com/share/17gfb9Mvmh/" target="_blank"><i class="fab fa-facebook fb-logo"></i></a>
            <button class="dark-mode-btn" onclick="toggleDarkMode()">
                <i class="fas fa-moon" id="theme-icon"></i> <span id="theme-text">Dark</span>
            </button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('image', event)"><i class="fas fa-camera"></i> <span class="tab-text">Image</span></div>
        <div class="tab" onclick="switchTab('video', event)"><i class="fas fa-video"></i> <span class="tab-text">Video</span></div>
    </div>

    <div class="grid">
        <div>
            <label class="label"><i class="fas fa-mobile-alt"></i> Model</label>
            <select class="select-box" onchange="updateModel(this.value)">
                <option value="iphone">iPhone 14 Pro</option>
                <option value="vivo">vivo Y72 5G</option>
            </select>
        </div>
        
        <div id="video-options" style="display: none;">
            <label class="label"><i class="fas fa-expand"></i> Platform Size</label>
            <select class="select-box" onchange="updateSize(this.value)">
                <option value="tiktok">TikTok (9:16)</option>
                <option value="youtube">YouTube (16:9)</option>
                <option value="fb">Facebook (1:1)</option>
            </select>
        </div>

        <div>
            <label class="label"><i class="fas fa-palette"></i> Color</label>
            <select class="select-box" onchange="updateColor(this.value)">
                <option value="#1c1c1c">Black</option>
                <option value="#ffd700">Gold</option>
            </select>
        </div>
    </div>

    <div id="capture-area" onclick="document.getElementById('file-in').click()">
        <div class="phone-frame" id="phone-ui">
            <i class="fas fa-plus-circle" id="plus-icon"></i>
            <img id="preview-img">
            <video id="preview-video" muted playsinline loop></video>
        </div>
    </div>

    <input type="file" id="file-in" style="display:none;">

    <button class="btn btn-upload" onclick="document.getElementById('file-in').click()">
        <i class="fas fa-images"></i> <span class="btn-text">Choose Media</span>
    </button>

    <button class="btn btn-save" id="save-btn" onclick="saveProject()">
        <i class="fas fa-download"></i> <span class="btn-text" style="color: white;">Download Now</span>
    </button>
</div>

<script>
    let currentMode = 'image';
    const canvas = document.getElementById('capture-area');
    const phone = document.getElementById('phone-ui');
    const img = document.getElementById('preview-img');
    const video = document.getElementById('preview-video');
    const fileIn = document.getElementById('file-in');
    const saveBtn = document.getElementById('save-btn');
    const videoOpt = document.getElementById('video-options');

    function toggleDarkMode() {
        const body = document.body;
        const icon = document.getElementById('theme-icon');
        const text = document.getElementById('theme-text');
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme'); icon.className = 'fas fa-moon'; text.innerText = 'Dark';
        } else {
            body.setAttribute('data-theme', 'dark'); icon.className = 'fas fa-sun'; text.innerText = 'Light';
        }
    }

    function switchTab(mode, event) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.currentTarget.classList.add('active');
        fileIn.accept = mode === 'image' ? "image/*" : "video/*";
        videoOpt.style.display = mode === 'video' ? 'block' : 'none';
        
        // Reset view when switching
        canvas.style.aspectRatio = "unset";
        canvas.style.height = "480px";
        phone.style.transform = "scale(1)";
    }

    function updateSize(platform) {
        if (platform === 'tiktok') {
            canvas.style.aspectRatio = "9/16"; phone.style.transform = "scale(1)";
        } else if (platform === 'youtube') {
            canvas.style.aspectRatio = "16/9"; phone.style.transform = "scale(0.6)";
        } else if (platform === 'fb') {
            canvas.style.aspectRatio = "1/1"; phone.style.transform = "scale(0.8)";
        }
    }

    function updateModel(model) {
        phone.style.borderRadius = model === 'iphone' ? "45px" : "30px";
    }

    function updateColor(color) { phone.style.borderColor = color; }

    fileIn.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        document.getElementById('plus-icon').style.display = 'none';
        saveBtn.style.display = 'flex';
        if (currentMode === 'image') {
            img.src = url; img.style.display = 'block'; video.style.display = 'none';
        } else {
            video.src = url; video.style.display = 'block'; img.style.display = 'none'; video.play();
        }
    };

    async function saveProject() {
        const result = await html2canvas(canvas, { scale: 3 });
        const link = document.createElement('a');
        link.download = `KSO_${Date.now()}.png`;
        link.href = result.toDataURL();
        link.click();
    }
</script>

</body>
</html>
