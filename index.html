<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSO Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --accent: #007bff; 
            --bg: #f8f9fa; 
            --card: white; 
            --text: #333; 
            --tab-bg: #eee; 
            --canvas-bg: transparent; 
        }
        
        [data-theme="dark"] {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #f1f1f1;
            --tab-bg: #333;
        }

        @keyframes rainbow {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; transition: 0.3s; }
        body { background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 15px; color: var(--text); }

        .container { 
            background: var(--card); width: 100%; max-width: 550px; border-radius: 25px; padding: 25px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.1); text-align: center; position: relative;
            border: 4px solid transparent;
            background-image: linear-gradient(var(--card), var(--card)), 
                              linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff);
            background-origin: border-box; background-clip: padding-box, border-box;
            background-size: 200% auto; animation: rainbow 4s linear infinite;
        }
        
        .brand-name h2, .label, .tab span, .btn span, #theme-text { 
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff);
            background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: rainbow 3s linear infinite; font-weight: 900 !important;
            text-transform: uppercase; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .brand-name h2 { font-size: 32px; }

        i { color: var(--text) !important; -webkit-text-fill-color: initial !important; background: none !important; }

        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .right-section { display: flex; align-items: center; gap: 12px; }
        .fb-logo { color: #1877F2 !important; font-size: 26px; text-decoration: none; }
        
        .dark-mode-btn { background: var(--tab-bg); border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        .tabs { display: flex; background: var(--tab-bg); border-radius: 15px; padding: 5px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab.active { background: var(--card); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; text-align: left; margin-bottom: 20px; }
        .label { font-size: 11px; margin-bottom: 8px; display: block; }
        .select-box { width: 100%; padding: 12px; border: 1px solid #55555530; border-radius: 12px; background: var(--card); color: var(--text); outline: none; }

        /* ဘေးက အကွက်တွေ လုံးဝမပါစေရန် ပြင်ဆင်ထားသည် */
        #capture-area { 
            width: 100%; height: 480px; background: transparent; margin-bottom: 20px; border-radius: 20px;
            display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; cursor: pointer;
        }
        
        .phone-frame { 
            width: 210px; height: 440px; background: #000; border: 10px solid #1c1c1c; 
            border-radius: 40px; position: relative; display: flex; align-items: center; 
            justify-content: center; transition: 0.3s; z-index: 5;
            overflow: hidden; padding: 0;
        }
        
        #preview-img, #preview-video { 
            width: 100%; height: 100%; object-fit: cover; display: none; 
            border-radius: inherit;
        }
        
        #plus-icon { font-size: 45px; color: #ccc; opacity: 0.5; position: absolute; z-index: 1; }

        .btn-action-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn { padding: 15px; border-radius: 50px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 15px; }
        .btn-upload { background: transparent; border: 2px dashed var(--accent); }
        .btn-save { background: var(--accent); color: white; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <div class="brand-name"><h2>KSO</h2></div>
        <div class="right-section">
            <a href="https://www.facebook.com/share/17gfb9Mvmh/" target="_blank"><i class="fab fa-facebook fb-logo"></i></a>
            <button class="dark-mode-btn" onclick="toggleDarkMode()">
                <i class="fas fa-moon" id="theme-icon"></i> <span id="theme-text">Dark</span>
            </button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('image', event)"><i class="fas fa-camera"></i> <span>Image</span></div>
        <div class="tab" onclick="switchTab('video', event)"><i class="fas fa-video"></i> <span>Video</span></div>
    </div>

    <div class="grid">
        <div>
            <label class="label">Model</label>
            <select class="select-box" onchange="updateModel(this.value)">
                <option value="iphone">iPhone 14 Pro</option>
                <option value="samsung">Samsung S23 Ultra</option>
                <option value="vivo">vivo Y72 5G</option>
            </select>
        </div>
        
        <div>
            <label class="label">Frame Color</label>
            <select class="select-box" onchange="updateColor(this.value)">
                <option value="#1c1c1c">Black</option>
                <option value="#e3e4e5">Silver</option>
                <option value="#f5e3c7">Gold</option>
                <option value="#594f63">Purple</option>
                <option value="#a7c1d1">Blue</option>
            </select>
        </div>

        <div id="video-ctrl" style="display: none;">
            <label class="label">Platform</label>
            <select class="select-box" onchange="updateVideoSize(this.value)">
                <option value="9/16">TikTok</option>
                <option value="16/9">YouTube</option>
                <option value="1/1">Facebook</option>
            </select>
        </div>
    </div>

    <div id="capture-area" onclick="triggerFileSelect()">
        <div class="phone-frame" id="phone-ui">
            <i class="fas fa-plus-circle" id="plus-icon"></i>
            <img id="preview-img">
            <video id="preview-video" muted playsinline loop></video>
        </div>
    </div>

    <input type="file" id="file-in" style="display:none;">

    <div class="btn-action-group">
        <button class="btn btn-upload" onclick="triggerFileSelect()">
            <i class="fas fa-folder-open"></i> <span>File</span>
        </button>
        <button class="btn btn-save" id="save-btn" onclick="saveProject()">
            <i class="fas fa-download"></i> <span style="color:white">Save</span>
        </button>
    </div>
</div>

<script>
    let currentMode = 'image';
    const canvas = document.getElementById('capture-area');
    const phone = document.getElementById('phone-ui');
    const img = document.getElementById('preview-img');
    const video = document.getElementById('preview-video');
    const fileIn = document.getElementById('file-in');
    const saveBtn = document.getElementById('save-btn');
    const videoCtrl = document.getElementById('video-ctrl');

    function toggleDarkMode() {
        const body = document.body;
        const icon = document.getElementById('theme-icon');
        const text = document.getElementById('theme-text');
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme'); icon.className = 'fas fa-moon'; text.innerText = 'Dark';
        } else {
            body.setAttribute('data-theme', 'dark'); icon.className = 'fas fa-sun'; text.innerText = 'Light';
        }
    }

    function switchTab(mode, event) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.currentTarget.classList.add('active');
        img.style.display = 'none';
        video.style.display = 'none';
        video.pause();
        document.getElementById('plus-icon').style.display = 'block';
        saveBtn.style.display = 'none';
        videoCtrl.style.display = mode === 'video' ? 'block' : 'none';
        canvas.style.aspectRatio = "unset"; canvas.style.height = "480px"; phone.style.transform = "scale(1)";
    }

    function triggerFileSelect() {
        fileIn.accept = currentMode === 'image' ? "image/*" : "video/*";
        fileIn.click();
    }

    function updateVideoSize(ratio) {
        canvas.style.aspectRatio = ratio;
        if (ratio === '16/9') { phone.style.transform = "scale(0.55)"; canvas.style.height = "300px"; } 
        else if (ratio === '1/1') { phone.style.transform = "scale(0.75)"; canvas.style.height = "400px"; } 
        else { phone.style.transform = "scale(1)"; canvas.style.height = "480px"; }
    }

    function updateModel(model) { 
        if(model === 'iphone') phone.style.borderRadius = "40px";
        else if(model === 'samsung') phone.style.borderRadius = "8px";
        else phone.style.borderRadius = "25px";
    }

    function updateColor(color) { phone.style.borderColor = color; }

    fileIn.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        document.getElementById('plus-icon').style.display = 'none';
        saveBtn.style.display = 'flex';
        if (currentMode === 'image') {
            img.src = url; img.style.display = 'block'; video.style.display = 'none';
        } else {
            video.src = url; video.style.display = 'block'; img.style.display = 'none'; video.play();
        }
    };

    async function saveProject() {
        // သိမ်းလိုက်တဲ့အခါ ဘေးက ဘောင်တွေ၊ အရောင်တွေ လုံးဝမပါစေရန် backgroundColor: null ထားခြင်းဖြစ်သည်
        const result = await html2canvas(canvas, { 
            scale: 3, 
            backgroundColor: null,
            logging: false,
            useCORS: true 
        });
        const link = document.createElement('a');
        link.download = `KSO_Export_${Date.now()}.png`;
        link.href = result.toDataURL("image/png");
        link.click();
    }
</script>

</body>
</html>
