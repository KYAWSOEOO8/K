<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <title>DMO Studio Pro - Final Version</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --accent: #007bff; --bg: #f4f7f6; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        
        /* Welcome Screen */
        #welcome-screen { text-align: center; background: white; padding: 40px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .choice-card { background: #f8f9fa; border: 2px solid #eee; border-radius: 20px; padding: 25px; margin: 15px 0; cursor: pointer; transition: 0.3s; }
        .choice-card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .choice-card i { font-size: 40px; color: var(--accent); margin-bottom: 10px; }

        /* Main Editor */
        #main-tool { display: none; background: white; width: 100%; max-width: 420px; border-radius: 30px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; }
        
        #capture-area { width: 300px; height: 560px; margin: 0 auto 15px; position: relative; display: flex; justify-content: center; align-items: center; background: transparent; }
        .phone-frame { width: 250px; height: 520px; background: #000; border: 8px solid #333; border-radius: 44px; position: relative; overflow: hidden; }
        .notch { position: absolute; top: 12px; left: 50%; transform: translateX(-50%); width: 75px; height: 20px; background: #000; border-radius: 20px; z-index: 100; }
        
        #content-img, #content-video { width: 100%; height: 100%; object-fit: cover; display: none; }
        .btn { width: 100%; padding: 15px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 15px; }
        .btn-upload { background: #eef6ff; color: var(--accent); border: 2px dashed var(--accent); }
        .btn-save { background: var(--accent); color: white; display: none; }
        .btn-back { background: none; color: #888; font-size: 13px; margin-top: 10px; }
        
        #status-msg { font-size: 12px; color: #d9534f; margin-top: 10px; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <h2 style="margin-bottom: 20px;">DMO Mockup Studio</h2>
        <div class="choice-card" onclick="startTool('image')">
            <i class="fas fa-image"></i>
            <h3>Screenshot (ပုံ)</h3>
        </div>
        <div class="choice-card" onclick="startTool('video')">
            <i class="fas fa-video"></i>
            <h3>Screen Record (ဗီဒီယို)</h3>
        </div>
    </div>

    <div id="main-tool">
        <h3 id="tool-title" style="margin-bottom: 15px;">Editor</h3>
        
        <div id="capture-area">
            <div class="phone-frame" id="phone-ui">
                <div class="notch"></div>
                <img id="content-img">
                <video id="content-video" muted playsinline loop></video>
            </div>
        </div>

        <div id="status-msg">Processing... Please wait.</div>

        <input type="file" id="file-in" style="display:none;">
        <button class="btn btn-upload" id="upload-btn" onclick="document.getElementById('file-in').click()">
            <i class="fas fa-cloud-upload-alt"></i> ဖိုင်ရွေးချယ်ပါ
        </button>

        <button class="btn btn-save" id="save-btn">
            Get Started <i class="fas fa-download"></i>
        </button>

        <button class="btn btn-back" onclick="location.reload()">
            <i class="fas fa-arrow-left"></i> ရှေ့စာမျက်နှာသို့ပြန်သွားမည်
        </button>
    </div>

    <script>
        const welcomeScreen = document.getElementById('welcome-screen');
        const mainTool = document.getElementById('main-tool');
        const fileIn = document.getElementById('file-in');
        const img = document.getElementById('content-img');
        const video = document.getElementById('content-video');
        const saveBtn = document.getElementById('save-btn');
        const statusMsg = document.getElementById('status-msg');
        
        let mode = '';

        function startTool(selectedMode) {
            mode = selectedMode;
            welcomeScreen.style.display = 'none';
            mainTool.style.display = 'block';
            document.getElementById('tool-title').innerText = mode === 'image' ? "Image Editor" : "Video Editor";
            fileIn.accept = mode === 'image' ? "image/*" : "video/*";
        }

        fileIn.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const url = URL.createObjectURL(file);
            saveBtn.style.display = 'flex';

            if (mode === 'image') {
                img.src = url;
                img.style.display = 'block';
                video.style.display = 'none';
            } else {
                video.src = url;
                video.style.display = 'block';
                img.style.display = 'none';
                video.onloadedmetadata = () => video.play();
            }
        };

        saveBtn.onclick = async () => {
            saveBtn.disabled = true;
            statusMsg.style.display = 'block';

            if (mode === 'image') {
                // Image Save Logic
                try {
                    const canvas = await html2canvas(document.getElementById('capture-area'), {
                        useCORS: true,
                        scale: 3,
                        backgroundColor: null
                    });
                    const link = document.createElement('a');
                    link.download = `DMO_Mockup_${Date.now()}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                } catch (err) {
                    alert("ပုံသိမ်းလို့မရပါ: " + err);
                }
            } else {
                // Video Save Logic
                try {
                    const stream = video.captureStream();
                    const recorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
                    const chunks = [];
                    recorder.ondataavailable = (e) => chunks.push(e.data);
                    recorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'video/webm' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `DMO_Mockup_Video_${Date.now()}.webm`;
                        a.click();
                    };
                    video.currentTime = 0;
                    video.play();
                    recorder.start();
                    setTimeout(() => {
                        recorder.stop();
                        saveBtn.disabled = false;
                        statusMsg.style.display = 'none';
                    }, video.duration * 1000);
                    return; // exit to prevent immediate reset
                } catch (err) {
                    alert("ဗီဒီယိုသိမ်းလို့မရပါ: " + err);
                }
            }
            saveBtn.disabled = false;
            statusMsg.style.display = 'none';
        };
    </script>
</body>
</html>
